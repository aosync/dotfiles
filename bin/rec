#!/bin/sh

rec() {
	LIBVA_DRIVER_NAME=iHD ffmpeg -device /dev/dri/card0 -f kmsgrab -i - -vf 'hwmap=derive_device=vaapi,scale_vaapi=w=1920:h=1080:format=nv12' -c:v h264_vaapi output.mp4 | wl-copy
	chown aws:aws output.mp4
}

if [ $(id -u) -ne 0 ]; then
	doas $0
else
	rec $@
fi
